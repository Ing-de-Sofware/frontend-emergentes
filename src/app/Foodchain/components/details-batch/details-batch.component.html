<div class="details-container">

  <header class="details-header">
    <button class="back-button" (click)="router.navigate(['/sidenav/view-batch'])">
      &larr; Volver a Mis Lotes
    </button>

    <div *ngIf="batchData" class="header-title">
      <h1>Detalles del Lote: {{ batchData.lotName }}</h1>
    </div>

    <button *ngIf="batchData" class="edit-button" (click)="editBatch()">
      Editar Lote
    </button>
  </header>

  <div *ngIf="isLoading" class="state-message loading">
    <p>Cargando detalles del lote...</p>
  </div>
  <div *ngIf="errorMessage" class="state-message error">
    <p>{{ errorMessage }}</p>
  </div>

  <div *ngIf="batchData" class="details-grid">

    <div class="info-section">
      <div class="card">
        <h3>Información General</h3>
        <p><strong>ID de Lote:</strong> {{ batchData.id }}</p>
        <p><strong>Productor ID:</strong> {{ batchData.producer_id }}</p>
        <p><strong>Granja:</strong> {{ batchData.farmName }}</p>
        <p><strong>Variedad:</strong> {{ batchData.variety }}</p>
        <p><strong>Fecha de Cosecha:</strong> {{ batchData.harvestDate | date: 'longDate' }}</p>
        <p><strong>Fecha de Creación:</strong> {{ batchData.createdDate | date: 'short' }}</p>
        <p><strong>Estado:</strong>
          <span class="status-tag"
                [class.active]="batchData.state === 'Activo'"
                [class.closed]="batchData.state === 'Cerrado'">
            {{ batchData.state }}
          </span>
        </p>
      </div>

      <!--
  <div class="card description-card">
    <h3>Descripción</h3>
    <p>{{ batchData.description || 'Sin descripción proporcionada.' }}</p>
  </div>
  -->



      <div class="card">
        <h3>Pasos de Trazabilidad Registrados</h3>

        <div *ngIf="steps.length === 0">
          <p>No se han registrado pasos de trazabilidad para este lote.</p>
        </div>

        <ul *ngIf="steps.length > 0" class="steps-list">
          <li *ngFor="let step of steps; let i = index" class="step-item">
            <h4>{{ i + 1 }}. {{ step.stepType }}</h4>
            <p>
              <span class="step-location">Ubicación: {{ step.location }}</span>
            </p>
            <p class="step-date">
              Fecha: {{ step.stepDate | date: 'mediumDate' }} a las {{ step.stepTime }}
            </p>
            <hr *ngIf="i < steps.length - 1">
          </li>
        </ul>
      </div>
    </div>

    <div class="qr-section">
      <div class="card qr-card">
        <h3>Código de Trazabilidad</h3>
        <p>Este código enlaza a la información pública del lote.</p>
        <p class="qr-link">URL Pública: <a [href]="qrUrl" target="_blank">{{ qrUrl }}</a></p>
        <div *ngIf="qrGenerated" class="qr-code-display">
          <qrcode
            #qrCode
            [qrdata]="qrData"
            [width]="256"
            [colorDark]="'#003366'"
            [colorLight]="'#ffffff'"
            (qrCodeURL)="captureQRData($event)" ></qrcode>
        </div>

        <button class="download-button" (click)="downloadQR()">
          <i class="fas fa-download"></i> Descargar QR
        </button>
      </div>

      <div *ngIf="batchData?.imageUrl" class="card product-image-card">
        <h3>Imagen del Lote</h3>
        <img [src]="batchData.imageUrl" alt="Imagen del Lote">
      </div>
    </div>

  </div>
</div>
